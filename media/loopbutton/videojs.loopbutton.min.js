/* ! Loopbutton v1.0.0 Copyright 2014 Charlotte Dunois https://github.com/CharlotteDunois/videojs-loopbutton/blob/master/LICENSE.md ! */
videojs.plugin('loopbutton', function(options) {
	var player = this;
	
	_V_.LoopButton = _V_.Button.extend({
		init: function(player, options) {
			_V_.Button.call(this, player, options);
			this.on('click', this.onClick);
		}
    });
	
	_V_.LoopButton.prototype.buttonText = 'Loop';
	
	_V_.PlayToggle.prototype.buildCSSClass = function(){
		return 'vjs-loop-button ' + vjs.Button.prototype.buildCSSClass.call(this);
	};
	
    _V_.LoopButton.prototype.onClick = function() {
    	//I changed this part to use loop() function
		if(player.loop() == true) {
			this.removeClass('vjs-control-active');
			player.loop(false);
		} else {
			this.addClass('vjs-control-active');
			player.loop(true);
		}
    };

    player.ready(function(){
		var button = new _V_.LoopButton(player,  {
			el: _V_.Component.prototype.createEl('div', {
				className	: 'vjs-loop-button',
				innerHTML: '<div class="vjs-control-content"><span class="vjs-control-text">Loop</span></div>',
				role: 'button'
			}) 
		});
		player.controlBar.addChild(button);
		
		//I removed "on ended" event
		//with loop() function there is no need to play the video every time it ends
	});
});
