{% extends 'baselayout.html' %}

{% block extrahead %}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/tagmanager.css">
{% endblock %}

{% block extrajs %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.jeditable.mini.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.jeditable.checkbox.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/tagmanager.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/typeahead.bundle.min.js"></script>
    <script type='text/javascript'>
        
     var edit_post_url = '{% url 'dictionary:update_gloss' gloss.id %}';
     var definition_role_choices = {{gloss.definition_role_choices_json|safe}}
     var handshape_choices = {{gloss.handshape_choices_json|safe}}
     var location_choices = {{gloss.location_choices_json|safe}}
     var palm_orientation_choices = {{gloss.palm_orientation_choices_json|safe}}
     var relative_orientation_choices = {{gloss.relative_orientation_choices_json|safe}}
     var secondary_location_choices = {{gloss.secondary_location_choices_json|safe}}
     var languages = {{gloss.language_choices|safe}};
     var dialects = {{gloss.dialect_choices|safe}};
     var csrf_token = '{{csrf_token}}';
      
    </script>
    <script type='text/javascript' src="{{ STATIC_URL }}js/gloss_edit.js"></script>
{% endblock %}


{% block content %}

{% if perms.dictionary.change_gloss %}
<div class='pull-right'>
     <span id='edit_message'></span>&nbsp;
     <button id='delete_gloss_btn' class='btn' data-toggle='modal' data-target='#delete_gloss_modal'>Delete Gloss</button>
     <button id='enable_edit' class='btn'>Enable Edit</button>
     
     <div class="modal fade" id="delete_gloss_modal" tabindex="-1" role="dialog" aria-labelledby="#modalTitle" aria-hidden="true">
         <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class='modal-header'>
                    <h2 id='modalTitle'>Delete This Gloss</h2>
                </div>
                <div class='modal-body'>
                    <p>This action will delete this gloss and all
                    associated records. It cannot be undone.</p>
                 </div>
              <form action='{% url 'dictionary:update_gloss' gloss.id %}' method='post'>
                  {% csrf_token %}
                  <input type='hidden' name='id' value='deletegloss'>
                  <input type='hidden' name='value' value='confirmed'>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <input type="submit" class="btn btn-primary" value='Confirm Delete'>
                  </div>
              </form>
                  
            </div>
          </div>
</div>
     
</div>
{% endif %}

<div id="signinfo">
    <div id="signs">
        {% if SIGN_NAVIGATION %}
            {% if navigation.prev %}
            <div class="prev">
              <a href="{% url 'root_page' %}dictionary/gloss/{{navigation.prev.pk}}">&laquo; Previous Sign</a>
            </div>
            {% endif %}
            {% if navigation.next %}
            <div class="next">
             <a href="{% url 'root_page' %}dictionary/gloss/{{navigation.next.pk}}">Next Sign &raquo;</a>
            </div>
            {% endif %}
         {% endif %}
    </div>
</div>

<div id="definitionblock">
    <div id="leftblock">
    <div id="videocontainer">
    {% if gloss.get_video %}

        <div id="player">
          <iframe width="320" height="240" scrolling="no" frameborder='0'
              src="{% url 'signbank.video.views.iframe' gloss.pk %}">
          </iframe>
        </div>
        <div id="replay"></div>

    {% else %}
        <img src='{{ STATIC_URL }}images/no-video.png'>
    {% endif %}
    
    </div>
    {% if perms.dictionary.update_video %}
    <div class='editform'>
        <fieldset>
            <legend>Upload New Video</legend>
            <p>We have {{gloss.count_videos}} videos for this gloss.</p>
            <form action="/video/upload/" method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <input type='hidden' name='redirect' value='{{request.path}}'>
            <table id="staffops">
              <tr>
                  <td>{{videoform.videofile}}</td>
                  <td><input type='hidden' name='gloss_id' value='{{gloss.pk}}'>
                      <input type='submit' value='Upload'/></td>
              </tr>
            </table>
            </form>
        </fieldset>
    
        {% if perms.dictionary.update_video %}
        <fieldset>
         <legend>Delete/Revert Video</legend>
            <table>
            <form action="/video/delete/{{gloss.pk}}" method='post'>
            <tr><td><em>This will delete the most recent upload and restore the most recent earlier version.</em></td></tr>
            <tr><td>{% csrf_token %}<input id='delete_video' type='submit' value='Delete/Revert this video'></td></tr>
            </form>
           </table>
        </fieldset>
        {% endif %}
    </div>
    {% endif %}


    {% include "dictionary/glosstags.html" %}
</div>

    <div id="definition">
    
    <table class='table table-condensed'>
        <tr><th>Sign Number:</th><td class='edit edit_int' id='sn'>{{gloss.sn}}</th></tr>
        <tr><th>IdGloss:</th><td class='edit edit_text' id='idgloss'>{{gloss.idgloss}}</th></tr>
        <tr><th>Annotation ID Gloss:</th><td class='edit edit_text'  id='annotation_idgloss'>{{gloss.annotation_idgloss}}</th></tr>
        <tr><th>Keywords</th><td class='edit edit_text' id='keywords'>{% for trn in gloss.translation_set.all %}{{ trn.translation }}{% if not forloop.last %}, {% endif %}{% endfor %}</th></tr>
        <tr><th>Sense Number</th><td class='edit edit_int'  id='sense'>{{gloss.sense}}</td></tr>
        <tr><th>Morphology</th><td class='edit edit_text' id='morph'>{{gloss.morph}}</td></tr>
        <tr><th>Stem Sign Number</th><td class='edit edit_text' id='StemSN'>{{gloss.StemSN}}</td></tr>
        <tr><th>Compound of</th><td class='edit edit_text' id='compound'>{{gloss.compound}}</td></tr>
        <tr><th>Language</th><td class='edit edit_language' id='language'>{% for lang in gloss.language.all %}{{lang.name}}{% if not forloop.last %}, {% endif %}{% endfor %}</td></tr>
        <tr><th>Dialect</th><td class='edit edit_dialect' id='dialect'>{% for dia in gloss.dialect.all %}{{dia.name}}{% if not forloop.last %}, {% endif %}{% endfor %}</td></tr>
    </table>
    
    <h3>Publication Status</h3>
        
    <table class='table table-condensed'>
        <tr><th>In Web Dictionary</th><td class='edit edit_check' id='inWeb'>{% if gloss.inWeb %}Yes{% else %}No{% endif %}</td></tr>
        <tr><th>Proposed New Sign</th><td class='edit edit_check' id='isNew'>{% if gloss.isNew %}Yes{% else %}No{% endif %}</td></tr>
    </table>
    
    <h3>Phonology</h3>
        
    <table class='table table-condensed'>
        <tr><th>Initial Palm Orientation</th><td class='edit edit_palm' id='initial_palm_orientation'>{{gloss.get_initial_palm_orientation_display}}</td></tr>
        <tr><th>Final Palm Orientation</th><td class='edit edit_palm' id='final_palm_orientation'>{{gloss.get_final_palm_orientation_display}}</td></tr>

        <tr><th>Initial Relative Orientation</th><td class='edit edit_relori' id='initial_relative_orientation'>{{gloss.get_initial_relative_orientation_display}}</td></tr>
        <tr><th>Final Relative Orientation</th><td class='edit edit_relori' id='final_relative_orientation'>{{gloss.get_final_relative_orientation_display}}</td></tr>

        <tr><th>Dominant Hand Shape</th><td class='edit edit_handshape' id='domhndsh'>{{gloss.get_domhndsh_display}}</td></tr>
        <tr><th>Subordinate Hand Shape</th><td class='edit edit_handshape' id='subhndsh'>{{gloss.get_subhndsh_display}}</td></tr>
        <tr><th>Final Dominant Hand Shape</th><td class='edit edit_handshape' id='final_domhndsh'>{{gloss.get_final_domhndsh_display}}</td></tr>
        <tr><th>Final Subordinate Hand Shape</th><td class='edit edit_handshape' id='final_subhndsh'>{{gloss.get_final_subhndsh_display}}</td></tr>

        <tr><th>Primary Location</th><td class='edit edit_location' id='locprim'>{{gloss.get_locprim_display}}</td></tr>
        <tr><th>Secondary Location</th><td class='edit edit_location' id='locsecond'>{{gloss.get_locsecond_display}}</td></tr>
        <tr><th>Final Location</th><td class='edit edit_location' id='final_loc'>{{gloss.get_final_loc_display}}</td></tr>
        
        <tr><th>Initial Secondary Location (BSL)</th><td class='edit edit_sec_location' id='initial_secondary_loc'>{{gloss.get_initial_secondary_loc_display}}</td></tr>
        <tr><th>Final Secondary Location (BSL)</th><td class='edit edit_sec_location' id='final_secondary_loc'>{{gloss.get_final_secondary_loc_display}}</td></tr>
        
    </table>
    
    
    <h3>Definitions/Notes</h3>

    {% regroup gloss.definition_set.all by role as roles %}
    
    <table class='table'>
      <tr>
          <th style='width:3em'>Index</th><th style='width:10em'>Role</th><th>Text</th>
      </tr>
    {% for role in roles %}

      {% for def in role.list %} 
      <tr> 
        <td class='edit edit_int' id='definitioncount_{{def.id}}'>{{def.count}}</td>   
        <td class='edit edit_role' id='definitionrole_{{def.id}}'>{{def.get_role_display}}</td>
        <td class='edit edit_area' id='definition_{{def.id}}'>{{def.text}}</td>
      </tr>
      {% endfor %}
      

    {% endfor %}
    </table>
    
    <form id='add-definition' action='/dictionary/update/definition/{{gloss.id}}' method="POST">
        <fieldset>
        {% csrf_token %}
         <table class='table'>
            <tr>
                <td style='width:5em'><input class='form-control' name='count' type='number'></td>   
                <td style='width:10em'>{{definitionform.role}}</td>
                <td><input class='form-control' name='text' placeholder='Enter new definition/note'></td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td><input class='btn' type='submit' value='Save New'></td>
            </tr>
         </table>
    </fieldset>
    
    </form>
    
    

    </div>
</div>


{% endblock %}
